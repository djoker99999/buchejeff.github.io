<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🪓 La Bûche Magique</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2071&q=80') no-repeat center center fixed;
background-size: cover;
color: #fff;
text-align: center;
min-height: 100vh;
padding: 10px;
position: relative;
overflow-x: hidden;
display: flex;
justify-content: center;
align-items: center;
}

body::before {
content: '';
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.4);
z-index: -1;
}

body {
filter: brightness(1.1) contrast(1.1);
}

.game-container {
max-width: 500px;
width: 100%;
margin: 0 20px;
background: rgba(0, 0, 0, 0.7);
border-radius: 20px;
padding: 20px;
backdrop-filter: blur(10px);
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
position: relative;
border: 2px solid rgba(139, 69, 19, 0.5);
}

.game-container::before {
content: '';
position: absolute;
top: -2px;
left: -2px;
right: -2px;
bottom: -2px;
background: linear-gradient(45deg, #8B4513, #D2691E, #228B22, #8B4513);
border-radius: 22px;
z-index: -1;
animation: borderGlow 3s linear infinite;
}

@keyframes borderGlow {
0% { filter: hue-rotate(0deg); }
100% { filter: hue-rotate(360deg); }
}

h1 {
font-size: 2.2em;
margin-bottom: 15px;
text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
background: linear-gradient(45deg, #8B4513, #D2691E);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.instructions {
margin: 20px 0;
padding: 15px;
background: rgba(255, 255, 255, 0.1);
border-radius: 15px;
backdrop-filter: blur(10px);
}

.instructions h2 {
font-size: 1.5em;
margin-bottom: 8px;
background: linear-gradient(45deg, #8B4513, #D2691E);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.instructions p {
font-size: 1.1em;
font-weight: bold;
color: #D2691E;
}

.log-container {
position: relative;
margin: 20px auto;
display: flex;
justify-content: center;
align-items: center;
width: 100%;
min-height: 200px;
}

.log {
width: 200px;
height: 180px;
margin: 0 auto;
background-image: url('https://i.ibb.co/JW6VkCX3/buche-bois-materiel-construction-bois-ecorce-element-forestier-bois-brun-illustration-dessinee-main.png');
background-size: contain;
background-repeat: no-repeat;
background-position: center;
position: relative;
transition: all 0.3s ease;
filter: drop-shadow(0 0 15px rgba(139, 69, 19, 0.7));
z-index: 5;
}

.log.noob {
filter: drop-shadow(0 0 15px rgba(135, 206, 235, 0.7)) brightness(1.2);
}

.log.buchette {
filter: drop-shadow(0 0 15px rgba(218, 112, 214, 0.7)) brightness(1.1);
}

.log.easy {
filter: drop-shadow(0 0 15px rgba(0, 255, 0, 0.7)) brightness(1.1);
}

.log.medium {
filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)) brightness(1.1) hue-rotate(15deg);
}

.log.hard {
filter: drop-shadow(0 0 25px rgba(255, 0, 0, 0.8)) brightness(1.1) hue-rotate(330deg);
animation: redGlow 2s ease-in-out infinite alternate;
}

@keyframes redGlow {
0% { filter: drop-shadow(0 0 25px rgba(255, 0, 0, 0.8)) brightness(1.1) hue-rotate(330deg); }
100% { filter: drop-shadow(0 0 35px rgba(255, 50, 50, 1)) brightness(1.3) hue-rotate(320deg); }
}

.log.hit {
animation: lightHit 0.4s ease-out;
}

.log.heavy-hit {
animation: heavyHit 0.6s ease-out;
}

.log.critical-hit {
animation: criticalHit 0.8s ease-out;
}

.log.mega-hit {
animation: megaHit 1.2s ease-out;
}

.log.ultra-hit {
animation: ultraHit 1.5s ease-out;
}

.log.cracked {
filter: brightness(0.7) drop-shadow(0 0 15px rgba(255, 0, 0, 0.8));
animation: redPulse 1s infinite;
}

.log.broken {
opacity: 0.3;
filter: grayscale(100%) brightness(0.3);
animation: knockout 1.5s ease-out forwards;
}

@keyframes lightHit {
0% { transform: translateX(0) rotate(0deg); }
25% { transform: translateX(-10px) rotate(-5deg); }
50% { transform: translateX(5px) rotate(3deg); }
75% { transform: translateX(-3px) rotate(-2deg); }
100% { transform: translateX(0) rotate(0deg); }
}

@keyframes heavyHit {
0% { transform: translateX(0) rotate(0deg) scale(1); }
20% { transform: translateX(-15px) rotate(-10deg) scale(0.95); }
40% { transform: translateX(8px) rotate(5deg) scale(1.05); }
60% { transform: translateX(-4px) rotate(-3deg) scale(0.98); }
80% { transform: translateX(2px) rotate(2deg) scale(1.02); }
100% { transform: translateX(0) rotate(0deg) scale(1); }
}

@keyframes criticalHit {
0% { transform: translateX(0) rotate(0deg) scale(1); }
15% { transform: translateX(-20px) rotate(-15deg) scale(0.9); }
30% { transform: translateX(12px) rotate(10deg) scale(1.1); }
45% { transform: translateX(-8px) rotate(-6deg) scale(0.95); }
60% { transform: translateX(5px) rotate(4deg) scale(1.05); }
75% { transform: translateX(-3px) rotate(-2deg) scale(0.98); }
90% { transform: translateX(1px) rotate(1deg) scale(1.02); }
100% { transform: translateX(0) rotate(0deg) scale(1); }
}

@keyframes megaHit {
0% { transform: translateX(0) rotate(0deg) scale(1); }
10% { transform: translateX(-25px) rotate(-20deg) scale(0.85); }
20% { transform: translateX(15px) rotate(12deg) scale(1.15); }
30% { transform: translateX(-12px) rotate(-8deg) scale(0.9); }
40% { transform: translateX(8px) rotate(6deg) scale(1.1); }
50% { transform: translateX(-6px) rotate(-4deg) scale(0.95); }
60% { transform: translateX(4px) rotate(3deg) scale(1.05); }
70% { transform: translateX(-2px) rotate(-2deg) scale(0.98); }
80% { transform: translateX(1px) rotate(1deg) scale(1.02); }
90% { transform: translateX(-0.5px) rotate(-0.5deg) scale(0.99); }
100% { transform: translateX(0) rotate(0deg) scale(1); }
}

@keyframes ultraHit {
0% { transform: translateX(0) rotate(0deg) scale(1); }
8% { transform: translateX(-30px) rotate(-25deg) scale(0.8); }
16% { transform: translateX(20px) rotate(15deg) scale(1.2); }
24% { transform: translateX(-15px) rotate(-12deg) scale(0.85); }
32% { transform: translateX(12px) rotate(10deg) scale(1.15); }
40% { transform: translateX(-8px) rotate(-8deg) scale(0.9); }
48% { transform: translateX(6px) rotate(5deg) scale(1.1); }
56% { transform: translateX(-4px) rotate(-4deg) scale(0.95); }
64% { transform: translateX(3px) rotate(3deg) scale(1.05); }
72% { transform: translateX(-2px) rotate(-2deg) scale(0.98); }
80% { transform: translateX(1px) rotate(1deg) scale(1.02); }
88% { transform: translateX(-0.5px) rotate(-0.5deg) scale(0.99); }
96% { transform: translateX(0.3px) rotate(0.3deg) scale(1.01); }
100% { transform: translateX(0) rotate(0deg) scale(1); }
}

@keyframes knockout {
0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
30% { transform: translateY(-10px) rotate(-15deg) scale(0.95); opacity: 0.9; }
70% { transform: translateY(40px) rotate(-90deg) scale(0.8); opacity: 0.7; }
100% { transform: translateY(60px) rotate(-90deg) scale(0.7); opacity: 0.4; }
}

@keyframes redPulse {
0%, 100% { filter: brightness(0.7) drop-shadow(0 0 15px rgba(255, 0, 0, 0.8)); }
50% { filter: brightness(0.5) drop-shadow(0 0 25px rgba(255, 0, 0, 1)); }
}

.screen-shake {
animation: screenShake 0.4s ease-out;
}

.mega-shake {
animation: megaShake 0.8s ease-out;
}

.ultra-shake {
animation: ultraShake 1.2s ease-out;
}

@keyframes screenShake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-3px); }
75% { transform: translateX(3px); }
}

@keyframes megaShake {
0%, 100% { transform: translateX(0) translateY(0); }
10% { transform: translateX(-5px) translateY(-2px); }
20% { transform: translateX(5px) translateY(2px); }
30% { transform: translateX(-4px) translateY(-1px); }
40% { transform: translateX(4px) translateY(1px); }
50% { transform: translateX(-3px) translateY(-1px); }
60% { transform: translateX(3px) translateY(1px); }
70% { transform: translateX(-2px) translateY(-0.5px); }
80% { transform: translateX(2px) translateY(0.5px); }
}

@keyframes ultraShake {
0%, 100% { transform: translateX(0) translateY(0); }
5% { transform: translateX(-8px) translateY(-3px); }
10% { transform: translateX(8px) translateY(3px); }
15% { transform: translateX(-6px) translateY(-2px); }
20% { transform: translateX(6px) translateY(2px); }
25% { transform: translateX(-4px) translateY(-1px); }
30% { transform: translateX(4px) translateY(1px); }
35% { transform: translateX(-3px) translateY(-1px); }
40% { transform: translateX(3px) translateY(1px); }
45% { transform: translateX(-2px) translateY(-0.5px); }
50% { transform: translateX(2px) translateY(0.5px); }
55% { transform: translateX(-1px) translateY(-0.2px); }
60% { transform: translateX(1px) translateY(0.2px); }
}

.impact-effect {
position: absolute;
font-size: 2em;
pointer-events: none;
z-index: 3;
animation: impactPop 1s ease-out forwards;
opacity: 0;
filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
}

@keyframes impactPop {
0% { opacity: 0; transform: scale(0.3) translateY(0); }
30% { opacity: 1; transform: scale(1.3) translateY(-10px); }
100% { opacity: 0; transform: scale(1) translateY(-30px); }
}

.axe {
position: absolute;
width: 80px;
height: 80px;
z-index: 10;
pointer-events: none;
opacity: 0;
transform-origin: bottom center;
background-image: url('https://i.ibb.co/rRFcs8mn/png-clipart-battle-axe-the-elder-scrolls-v-skyrim-dragonborn-the-elder-scrolls-v-skyrim-dawnguard-we.png');
background-size: contain;
background-repeat: no-repeat;
background-position: center;
}

.axe-hit {
animation: axeSwing 0.6s ease-out forwards;
}

@keyframes axeSwing {
0% {
opacity: 0;
transform: translate(-50%, -100%) rotate(-35deg) scale(0.8);
}
20% {
opacity: 1;
transform: translate(-50%, -100%) rotate(15deg) scale(1);
}
40% {
transform: translate(-50%, -100%) rotate(-10deg) scale(1.1);
}
60% {
transform: translate(-50%, -100%) rotate(5deg) scale(1);
}
80% {
transform: translate(-50%, -100%) rotate(-2deg) scale(1);
}
100% {
opacity: 0;
transform: translate(-50%, -100%) rotate(0deg) scale(0.8);
}
}

.attack-modes {
display: flex;
justify-content: center;
gap: 12px;
margin: 15px 0;
flex-wrap: wrap;
}

.attack-mode-image {
width: 110px;
height: 110px;
cursor: pointer;
border: 2px solid rgba(255, 255, 255, 0.3);
border-radius: 15px;
background: rgba(255, 255, 255, 0.1);
transition: all 0.3s ease;
backdrop-filter: blur(5px);
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 10px;
position: relative;
}

.attack-mode-image:hover {
background: rgba(255, 255, 255, 0.2);
transform: translateY(-3px);
}

.attack-mode-image.active {
border-color: #fff;
box-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
background: rgba(255, 255, 255, 0.3);
transform: scale(1.05);
}

.attack-mode-image img {
width: 65px;
height: 65px;
object-fit: contain;
filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
}

.attack-mode-label {
font-size: 13px;
margin-top: 5px;
font-weight: bold;
color: #D2691E;
text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
}

.controls {
margin: 15px 0;
}

button {
padding: 12px 25px;
margin: 8px;
font-size: 14px;
cursor: pointer;
border: none;
border-radius: 20px;
background: linear-gradient(45deg, #8B4513, #654321);
color: #fff;
transition: all 0.3s ease;
box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
text-transform: uppercase;
font-weight: bold;
letter-spacing: 0.5px;
}

button:hover {
transform: translateY(-2px);
box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
background: linear-gradient(45deg, #D2691E, #8B4513);
}

button:active {
transform: translateY(0);
}

#resetBtn {
background: linear-gradient(45deg, #555, #777);
}

#resetBtn:hover {
background: linear-gradient(45deg, #777, #999);
}

#message {
margin: 15px 0;
font-size: 1.1em;
font-weight: bold;
text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
min-height: 25px;
}

.popup-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.7);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
opacity: 0;
visibility: hidden;
transition: all 0.3s ease;
}

.popup-overlay.active {
opacity: 1;
visibility: visible;
}

.popup-content {
background: linear-gradient(135deg, rgba(139, 69, 19, 0.95), rgba(210, 105, 30, 0.95));
padding: 25px;
border-radius: 20px;
max-width: 450px;
width: 90%;
text-align: center;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
border: 3px solid rgba(255, 255, 255, 0.5);
backdrop-filter: blur(10px);
transform: scale(0.7);
transition: transform 0.4s ease;
}

.popup-overlay.active .popup-content {
transform: scale(1);
}

.popup-content h3 {
font-size: 1.8em;
margin-bottom: 15px;
color: #fff;
text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.popup-reward-image {
width: 140px;
height: 140px;
margin: 15px auto;
background-size: contain;
background-repeat: no-repeat;
background-position: center;
border-radius: 10px;
box-shadow: 0 4px 15px rgba(0,0,0,0.4);
}

.popup-reward-text {
font-size: 1.3em;
margin: 15px 0;
color: #fff;
font-weight: bold;
text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

.popup-victory-message {
font-size: 1.4em;
margin: 15px 0;
color: #feca57;
text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
font-weight: bold;
}

.popup-close-btn {
padding: 10px 25px;
font-size: 16px;
cursor: pointer;
border: none;
border-radius: 20px;
background: linear-gradient(45deg, #8B4513, #654321);
color: #fff;
transition: all 0.3s ease;
box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
font-weight: bold;
margin-top: 15px;
}

.popup-close-btn:hover {
transform: translateY(-2px);
box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
background: linear-gradient(45deg, #D2691E, #8B4513);
}

.hidden {
display: none;
}

.coins-display {
position: absolute;
top: -15px;
left: 50%;
transform: translateX(-50%);
background: linear-gradient(45deg, #8B4513, #D2691E);
color: white;
padding: 4px 12px;
border-radius: 15px;
font-weight: bold;
animation: coinPop 1s ease;
pointer-events: none;
z-index: 4;
}

@keyframes coinPop {
0% {
opacity: 0;
transform: translateX(-50%) translateY(15px) scale(0.5);
}
50% {
opacity: 1;
transform: translateX(-50%) translateY(-8px) scale(1.1);
}
100% {
opacity: 0;
transform: translateX(-50%) translateY(-25px) scale(1);
}
}

.combo-indicator {
position: absolute;
top: 10px;
right: 10px;
background: linear-gradient(45deg, #8B4513, #654321);
padding: 8px 15px;
border-radius: 20px;
font-weight: bold;
font-size: 0.9em;
display: none;
box-shadow: 0 4px 10px rgba(0,0,0,0.3);
border: 2px solid rgba(255,255,255,0.2);
}

.difficulty-selector {
display: flex;
justify-content: center;
gap: 15px;
margin: 15px 0;
}

.difficulty-btn {
width: 80px;
height: 80px;
border-radius: 15px;
cursor: pointer;
transition: all 0.3s ease;
border: 3px solid rgba(255, 255, 255, 0.3);
background-size: cover;
background-position: center;
background-repeat: no-repeat;
position: relative;
overflow: hidden;
}

.difficulty-btn::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.2);
transition: all 0.3s ease;
}

.difficulty-btn:hover::before {
background: rgba(0, 0, 0, 0.1);
}

.difficulty-btn.noob {
background-image: url('https://i.ibb.co/gFMBxFzP/IMG-6063.png');
}

.difficulty-btn.buchette {
background-image: url('https://i.ibb.co/JMPfpWV/IMG-5851.png');
}

.difficulty-btn.easy {
background-image: url('https://i.ibb.co/p6s7HT5n/IMG-7322.png');
}

.difficulty-btn.medium {
background-image: url('https://i.ibb.co/hxXnkQh7/IMG-5861.png');
}

.difficulty-btn.hard {
background-image: url('https://i.ibb.co/DHBNtX7t/IMG-6573.png');
}

.difficulty-btn.active {
border-color: #D2691E;
box-shadow: 0 0 20px rgba(210, 105, 30, 0.8);
transform: scale(1.1);
}

.difficulty-btn.active::before {
background: rgba(210, 105, 30, 0.2);
}

@media (max-width: 480px) {
body {
padding: 5px;
justify-content: center;
}

.game-container {
padding: 15px;
margin: 5px;
}

h1 {
font-size: 1.8em;
}

.log {
width: 160px;
height: 140px;
}

.instructions {
padding: 10px;
margin: 15px 0;
}

.instructions h2 {
font-size: 1.3em;
}

.instructions p {
font-size: 1em;
}

.attack-modes {
gap: 8px;
}

.attack-mode-image {
width: 90px;
height: 90px;
padding: 8px;
}

.attack-mode-image img {
width: 50px;
height: 50px;
}

.attack-mode-label {
font-size: 11px;
}

button {
padding: 10px 20px;
font-size: 13px;
margin: 5px;
}

.difficulty-selector {
gap: 10px;
}

.difficulty-btn {
width: 70px;
height: 70px;
}

.popup-content {
padding: 20px;
max-width: 90%;
}

.popup-reward-image {
width: 120px;
height: 120px;
}

.popup-content h3 {
font-size: 1.5em;
}

.popup-reward-text {
font-size: 1.1em;
}

.popup-victory-message {
font-size: 1.2em;
}
}

.particles-container {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 1;
}

.particle {
position: absolute;
width: 4px;
height: 4px;
background: #D2691E;
border-radius: 50%;
pointer-events: none;
z-index: 2;
}

.difficulty-badge {
display: inline-block;
padding: 5px 15px;
border-radius: 20px;
font-weight: bold;
margin: 10px 0;
}

.difficulty-badge.noob {
background: linear-gradient(45deg, #87CEEB, #B0E0E6);
color: #000;
}

.difficulty-badge.buchette {
background: linear-gradient(45deg, #DDA0DD, #DA70D6);
}

.difficulty-badge.easy {
background: linear-gradient(45deg, #4CAF50, #8BC34A);
}

.difficulty-badge.medium {
background: linear-gradient(45deg, #FF9800, #FFC107);
}

.difficulty-badge.hard {
background: linear-gradient(45deg, #F44336, #E91E63);
}
</style>
</head>
<body>
<div class="game-container" id="gameContainer">
<div class="combo-indicator" id="comboIndicator">COMBO x0</div>

<h1>🪓 La Bûche Magique !</h1>

<div class="difficulty-selector">
<div class="difficulty-btn noob active" data-difficulty="noob" title="Noob - 1500 HP"></div>
<div class="difficulty-btn buchette" data-difficulty="buchette" title="Buchette - 5000 HP"></div>
<div class="difficulty-btn easy" data-difficulty="easy" title="Facile - 15000 HP"></div>
<div class="difficulty-btn medium" data-difficulty="medium" title="Moyen - 25000 HP"></div>
<div class="difficulty-btn hard" data-difficulty="hard" title="Difficile - 50000 HP"></div>
</div>

<div class="log-container">
<div class="log easy" id="log"></div>
<div class="particles-container" id="particlesContainer"></div>
</div>

<div class="instructions">
<h2>🪓 Coupe la Bûche Magique et Gagne le Trésor ! 🪓</h2>
<p>Un Coup de Hache = Un Point de Vie en Moins</p>
</div>

<div class="attack-modes">
<div id="mode1" class="attack-mode-image active">
<img src="https://i.ibb.co/WNXDxn2y/IMG-7354-Photoroom.png" alt="Rose - 1 coup">
<div class="attack-mode-label">1 coup</div>
</div>
<div id="mode10" class="attack-mode-image">
<img src="https://i.ibb.co/7JsBRrCn/IMG-5885.png" alt="Rosa - 10 coups">
<div class="attack-mode-label">10 coups</div>
</div>
<div id="mode30" class="attack-mode-image">
<img src="https://i.ibb.co/8DMJ0cxy/IMG-7355-Photoroom.png" alt="Donuts - 30 coups">
<div class="attack-mode-label">30 coups</div>
</div>
<div id="mode100" class="attack-mode-image">
<img src="https://i.ibb.co/C5M6DHcS/IMG-7356-Photoroom.png" alt="Coeurs - 100 coups">
<div class="attack-mode-label">100 coups</div>
</div>
<div id="mode500" class="attack-mode-image">
<img src="https://i.ibb.co/nNy17WfL/IMG-6065.png" alt="Mini Gun - 500 coups">
<div class="attack-mode-label">500 coups</div>
</div>
<div id="mode1000" class="attack-mode-image">
<img src="https://i.ibb.co/JMPfpWV/IMG-5851.png" alt="Galaxie - 1000 coups">
<div class="attack-mode-label">1000 coups</div>
</div>
</div>

<div class="controls">
<button id="attackBtn">Attaquer (1 coup)</button>
<button id="resetBtn">Nouvelle Bûche</button>
</div>

<p id="message"></p>
</div>

<div class="popup-overlay" id="victoryPopup">
<div class="popup-content">
<h3>🎉 Bûche Magique Coupée ! 🎉</h3>
<div id="popupRewardImage" class="popup-reward-image"></div>
<p id="popupRewardText" class="popup-reward-text"></p>
<div id="popupVictoryMessage" class="popup-victory-message"></div>
<button class="popup-close-btn" id="closePopupBtn">Continuer</button>
</div>
</div>

<script>
let maxHP, currentHP, coupCounter, totalHits;
let hitsUntilCoin = 4;
let attackMode = 1;
let coinsEarnedThisLog = 0;
let combo = 0;
let lastHitTime = 0;
let isAttacking = false;
let audioContext = null;
let currentDifficulty = "noob";

const log = document.getElementById("log");
const message = document.getElementById("message");
const attackBtn = document.getElementById("attackBtn");
const gameContainer = document.getElementById("gameContainer");
const comboIndicator = document.getElementById("comboIndicator");
const particlesContainer = document.getElementById("particlesContainer");

const victoryPopup = document.getElementById("victoryPopup");
const popupRewardImage = document.getElementById("popupRewardImage");
const popupRewardText = document.getElementById("popupRewardText");
const popupVictoryMessage = document.getElementById("popupVictoryMessage");
const closePopupBtn = document.getElementById("closePopupBtn");

const impactEffects = ["💥", "🔥", "⭐", "💫", "✨", "💢", "🪓", "🌲"];

function initAudioContext() {
try {
if (!audioContext) {
audioContext = new (window.AudioContext || window.webkitAudioContext)();
}
if (audioContext.state === 'suspended') {
audioContext.resume();
}
return audioContext;
} catch (e) {
return null;
}
}

function createSound(frequency, duration, type = 'sine', volume = 0.15) {
const context = initAudioContext();
if (!context) return;

try {
const oscillator = context.createOscillator();
const gainNode = context.createGain();

oscillator.connect(gainNode);
gainNode.connect(context.destination);

oscillator.frequency.value = frequency;
oscillator.type = type;

gainNode.gain.setValueAtTime(volume, context.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + duration);

oscillator.start(context.currentTime);
oscillator.stop(context.currentTime + duration);
} catch (e) {
}
}

function playHitSound() {
createSound(600, 0.1, 'square');
setTimeout(() => createSound(300, 0.05, 'triangle'), 50);
}

function playCrackSound() {
createSound(250, 0.3, 'sawtooth');
setTimeout(() => createSound(180, 0.2, 'sawtooth'), 100);
}

function playBreakSound() {
createSound(120, 0.5, 'sawtooth');
setTimeout(() => createSound(350, 0.3, 'square'), 100);
setTimeout(() => createSound(650, 0.2, 'sine'), 200);
}

function createAxe() {
const axe = document.createElement('div');
axe.className = 'axe';

const logRect = log.getBoundingClientRect();
const containerRect = log.parentElement.getBoundingClientRect();

axe.style.left = (logRect.left + logRect.width/2 - containerRect.left) + 'px';
axe.style.top = (logRect.top - containerRect.top) + 'px';

log.parentElement.appendChild(axe);

return axe;
}

function animateAxe() {
const axe = createAxe();
axe.classList.add('axe-hit');

setTimeout(() => {
if (axe.parentElement) {
axe.parentElement.removeChild(axe);
}
}, 600);
}

function createHitParticles() {
for (let i = 0; i < 8; i++) {
const particle = document.createElement('div');
particle.className = 'particle';

const logRect = log.getBoundingClientRect();
const containerRect = log.parentElement.getBoundingClientRect();

particle.style.left = (logRect.left + logRect.width/2 - containerRect.left + (Math.random() * 60 - 30)) + 'px';
particle.style.top = (logRect.top + logRect.height/2 - containerRect.top + (Math.random() * 60 - 30)) + 'px';

const colors = ['#D2691E', '#8B4513', '#CD853F', '#DEB887'];
particle.style.background = colors[Math.floor(Math.random() * colors.length)];

particlesContainer.appendChild(particle);

const angle = Math.random() * Math.PI * 2;
const distance = 30 + Math.random() * 40;

particle.animate([
{
transform: 'scale(1)',
opacity: 1
},
{
transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`,
opacity: 0
}
], {
duration: 500 + Math.random() * 300,
easing: 'ease-out'
}).onfinish = () => particle.remove();
}
}

function createImpactEffect() {
const effect = document.createElement('div');
effect.className = 'impact-effect';
effect.textContent = impactEffects[Math.floor(Math.random() * impactEffects.length)];
effect.style.left = (Math.random() * 70 + 15) + '%';
effect.style.top = (Math.random() * 50 + 25) + '%';

document.querySelector('.log-container').appendChild(effect);

setTimeout(() => {
effect.remove();
}, 1000);
}

function updateCombo() {
const currentTime = Date.now();
if (currentTime - lastHitTime > 2000) {
combo = 0;
}
combo++;
lastHitTime = currentTime;

if (combo >= 3) {
comboIndicator.textContent = `COMBO x${combo}`;
comboIndicator.style.display = 'block';
}
}

function attack() {
if (currentHP <= 0 || isAttacking) return;

isAttacking = true;

let hits = attackMode;
let actualHits = 0;
let coinsEarned = 0;
let wasCracked = log.classList.contains('cracked');

animateAxe();

playHitSound();
createHitParticles();
createImpactEffect();
updateCombo();

let animationType = 'hit';
let shakeType = 'screen-shake';
let animationDuration = 400;

if (attackMode >= 1000) {
animationType = 'ultra-hit';
shakeType = 'ultra-shake';
animationDuration = 1200;
} else if (attackMode >= 500) {
animationType = 'mega-hit';
shakeType = 'mega-shake';
animationDuration = 1000;
} else if (attackMode >= 100) {
animationType = 'critical-hit';
shakeType = 'mega-shake';
animationDuration = 800;
} else if (attackMode >= 30) {
animationType = 'heavy-hit';
animationDuration = 600;
} else if (attackMode >= 10) {
animationType = 'heavy-hit';
animationDuration = 600;
}

log.classList.add(animationType);
if (shakeType) gameContainer.classList.add(shakeType);

for (let i = 0; i < hits && currentHP > 0; i++) {
coupCounter++;
actualHits++;
totalHits++;

currentHP--;

hitsUntilCoin--;
if (hitsUntilCoin <= 0) {
coinsEarnedThisLog++;
coinsEarned++;
hitsUntilCoin = 4;
}
}

if (coinsEarned > 0) {
showCoinGain(coinsEarned);
}

updateUI();

if (!wasCracked && log.classList.contains('cracked')) {
playCrackSound();
}

setTimeout(() => {
log.classList.remove(animationType);
if (shakeType) gameContainer.classList.remove(shakeType);
isAttacking = false;

if (currentHP <= 0) {
endGame();
}
}, animationDuration);
}

function showCoinGain(amount) {
const coinDisplay = document.createElement('div');
coinDisplay.className = 'coins-display';
coinDisplay.textContent = `+${amount} 🪙`;
log.parentElement.appendChild(coinDisplay);

setTimeout(() => {
coinDisplay.remove();
}, 1000);
}

function updateUI() {
if (currentHP === 0) {
log.className = "log broken " + currentDifficulty;
message.textContent = "💥 La bûche magique a été coupée !";
} else {
if (maxHP - currentHP >= maxHP * 0.7) {
log.classList.add("cracked");
message.textContent = "⚠️ La bûche magique commence à se fendre...";
} else {
log.classList.remove("cracked");
let difficultyName = "";
switch(currentDifficulty) {
case "noob": difficultyName = "noob"; break;
case "buchette": difficultyName = "buchette"; break;
case "easy": difficultyName = "facile"; break;
case "medium": difficultyName = "moyenne"; break;
case "hard": difficultyName = "difficile"; break;
}
message.textContent = `Bûche magique ${difficultyName} - À tout moment la bûche peut se briser...`;
}
}
}

function showVictoryPopup() {
let rewardText = "";
let victoryText = "";
let rewardImg = "";

switch(currentDifficulty) {
case "noob":
rewardText = "300 pièces d'or !";
victoryText = "Bravo ! Tu as gagné tes premières pièces !";
rewardImg = "https://i.ibb.co/gFMBxFzP/IMG-6063.png";
break;
case "buchette":
rewardText = "vous avez gagné une galaxie !";
victoryText = "Incroyable ! Tu as découvert une galaxie entière !";
rewardImg = "https://i.ibb.co/JMPfpWV/IMG-5851.png";
break;
case "easy":
rewardText = "Vous avez gagné 3000 pièces !";
victoryText = "Félicitations ! Tu as remporté un superbe trésor !";
rewardImg = "https://i.ibb.co/p6s7HT5n/IMG-7322.png";
break;
case "medium":
rewardText = "Vous avez gagné 5000 pièces !";
victoryText = "Incroyable ! Tu as trouvé un trésor précieux !";
rewardImg = "https://i.ibb.co/hxXnkQh7/IMG-5861.png";
break;
case "hard":
rewardText = "Vous avez gagné 10000 pièces !";
victoryText = "Victoire totale ! Tu as remporté le jackpot !";
rewardImg = "https://i.ibb.co/DHBNtX7t/IMG-6573.png";
break;
}

popupRewardImage.style.backgroundImage = `url('${rewardImg}')`;

popupRewardText.innerHTML = `
<div class="difficulty-badge ${currentDifficulty}">NIVEAU ${currentDifficulty.toUpperCase()}</div><br>
<strong>RÉCOMPENSE :</strong><br>
${rewardText}
`;

popupVictoryMessage.textContent = victoryText;

victoryPopup.style.display = 'flex';
setTimeout(() => {
victoryPopup.classList.add('active');
}, 10);
}

function closeVictoryPopup() {
victoryPopup.classList.remove('active');
setTimeout(() => {
victoryPopup.style.display = 'none';
}, 300);
}

function endGame() {
playBreakSound();

message.textContent = "💥 Félicitations ! Tu as coupé la bûche magique ! 🪓✨";

setTimeout(() => {
showVictoryPopup();
}, 500);

comboIndicator.style.display = "none";
}

function setAttackMode(mode) {
attackMode = mode;

document.querySelectorAll('.attack-mode-image').forEach(btn => {
btn.classList.remove('active');
});

const btnEl = document.getElementById(`mode${mode}`);
if (btnEl) btnEl.classList.add('active');

attackBtn.textContent = `Attaquer (${mode} coup${mode > 1 ? 's' : ''})`;
}

function setDifficulty(difficulty) {
currentDifficulty = difficulty;

document.querySelectorAll('.difficulty-btn').forEach(btn => {
btn.classList.remove('active');
});
document.querySelector(`.difficulty-btn.${difficulty}`).classList.add('active');

log.className = "log " + difficulty;

initGame();
}

function initGame() {
switch(currentDifficulty) {
case "noob":
maxHP = 1500;
break;
case "buchette":
maxHP = 5000;
break;
case "easy":
maxHP = 15000;
break;
case "medium":
maxHP = 25000;
break;
case "hard":
maxHP = 50000;
break;
}

currentHP = maxHP;
coupCounter = 0;
totalHits = 0;
hitsUntilCoin = 4;
coinsEarnedThisLog = 0;
combo = 0;
lastHitTime = 0;
isAttacking = false;

log.className = "log " + currentDifficulty;

let difficultyName = "";
switch(currentDifficulty) {
case "noob": difficultyName = "noob"; break;
case "buchette": difficultyName = "buchette"; break;
case "easy": difficultyName = "facile"; break;
case "medium": difficultyName = "moyenne"; break;
case "hard": difficultyName = "difficile"; break;
}

message.textContent = `Bûche magique ${difficultyName} - À tout moment la bûche peut se briser...`;

closeVictoryPopup();
comboIndicator.style.display = "none";
}

document.getElementById("attackBtn").addEventListener("click", attack);
document.getElementById("resetBtn").addEventListener("click", initGame);

document.getElementById("mode1").addEventListener("click", () => setAttackMode(1));
document.getElementById("mode10").addEventListener("click", () => setAttackMode(10));
document.getElementById("mode30").addEventListener("click", () => setAttackMode(30));
document.getElementById("mode100").addEventListener("click", () => setAttackMode(100));
document.getElementById("mode500").addEventListener("click", () => setAttackMode(500));
document.getElementById("mode1000").addEventListener("click", () => setAttackMode(1000));

document.querySelectorAll('.difficulty-btn').forEach(btn => {
btn.addEventListener('click', function() {
setDifficulty(this.getAttribute('data-difficulty'));
});
});

closePopupBtn.addEventListener('click', closeVictoryPopup);

victoryPopup.addEventListener('click', function(e) {
if (e.target === this) {
closeVictoryPopup();
}
});

document.addEventListener('keydown', (e) => {
if (isAttacking) return;

switch(e.key) {
case ' ':
case 'Enter':
e.preventDefault();
attack();
break;
case '1':
setAttackMode(1);
break;
case '2':
setAttackMode(10);
break;
case '3':
setAttackMode(30);
break;
case '4':
setAttackMode(100);
break;
case '5':
setAttackMode(500);
break;
case '6':
setAttackMode(1000);
break;
case 'r':
case 'R':
initGame();
break;
case 'n':
case 'N':
setDifficulty('noob');
break;
case 'b':
case 'B':
setDifficulty('buchette');
break;
case 'e':
case 'E':
setDifficulty('easy');
break;
case 'm':
case 'M':
setDifficulty('medium');
break;
case 'd':
case 'D':
setDifficulty('hard');
break;
case 'Escape':
closeVictoryPopup();
break;
}
});

setInterval(() => {
const currentTime = Date.now();
if (currentTime - lastHitTime > 3000 && combo > 0) {
combo = 0;
comboIndicator.style.display = "none";
}
}, 1000);

initGame();
</script>
</body>
</html>
